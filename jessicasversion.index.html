<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç†Šç†Šå­¸è‹±æ–‡ - èªéŸ³äº’å‹•ç·´ç¿’</title>
    <!-- å¼•å…¥æ”¯æ´ HTTPS çš„å¤–éƒ¨è³‡æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        body {
            font-family: 'ZCOOL KuaiLe', 'Noto Sans TC', sans-serif;
            background-color: #fefce8; /* æº«æš–çš„æ·ºé»ƒè‰² */
            touch-action: manipulation;
        }
        
        /* éº¥å…‹é¢¨æ­£åœ¨éŒ„éŸ³çš„ç™¼å…‰æ•ˆæœ */
        .mic-active {
            animation: pulse-red 1.5s infinite;
            background-color: #ef4444 !important;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .bounce { animation: bounce 0.5s ease; }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* éŠæˆ²å¡ç‰‡é‚Šæ¡†è£é£¾ */
        .game-border {
            border: 8px solid #fbbf24;
            box-shadow: 0 20px 0px 0px #f59e0b;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- éŠæˆ²ä¸»å®¹å™¨ -->
    <div id="game-container" class="bg-white rounded-[3rem] p-8 w-full max-w-md text-center game-border relative overflow-hidden">
        
        <!-- é€²åº¦èˆ‡åˆ†æ•¸ -->
        <div class="flex justify-between items-center mb-6">
            <div id="starCount" class="text-2xl font-bold text-yellow-500 bg-yellow-50 px-4 py-1 rounded-full border-2 border-yellow-200">â­ 0</div>
            <div id="stepInfo" class="text-blue-400 font-bold text-lg italic">Step 1 / 5</div>
        </div>

        <!-- è§’è‰²èˆ‡é¡Œç›®å±•ç¤º -->
        <div class="mb-6 relative">
            <div id="avatar" class="text-8xl mb-4 drop-shadow-lg transition-transform">ğŸ»</div>
            <div id="itemBox" class="bg-blue-50 rounded-3xl py-10 mb-4 border-4 border-dashed border-blue-100 flex items-center justify-center">
                <span id="displayIcon" class="text-8xl">ğŸ</span>
            </div>
            <h2 id="questionText" class="text-2xl font-bold text-gray-800 mb-2 leading-tight">ç´…é€šé€šçš„æ°´æœæ˜¯ä»€éº¼ï¼Ÿ</h2>
            <div id="hintText" class="inline-block bg-blue-500 text-white px-6 py-1 rounded-full text-lg font-bold shadow-md">èªªèªªçœ‹ï¼šapple</div>
        </div>

        <!-- å›é¥‹è¨Šæ¯æ¬„ -->
        <div id="messageBoard" class="h-20 flex items-center justify-center text-lg font-medium text-blue-600 mb-8 bg-blue-50 rounded-2xl px-4 border border-blue-100 italic">
            æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šéº¥å…‹é¢¨è·Ÿæˆ‘èªªè©±ï¼
        </div>

        <!-- æ“ä½œå€ -->
        <div class="flex flex-col gap-4">
            <button id="micBtn" onclick="handleMic()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-3xl py-5 px-8 text-2xl font-bold flex items-center justify-center gap-3 transition-all transform active:scale-95 shadow-xl">
                <span id="micLabel">ğŸ¤ é–‹å§‹å¤§è²èªª</span>
            </button>
            <button onclick="skipQuestion()" class="text-gray-400 hover:text-gray-600 font-bold underline decoration-wavy">
                è·³éé€™é¡Œ (Skip)
            </button>
        </div>
    </div>

    <!-- æˆåŠŸéé—œå½ˆçª— -->
    <div id="winModal" class="fixed inset-0 bg-yellow-500/90 hidden items-center justify-center p-6 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-[3rem] p-10 text-center max-w-sm w-full shadow-[0_20px_0px_0px_#ca8a04] border-8 border-white">
            <div class="text-9xl mb-4 animate-bounce">ğŸ†</div>
            <h2 class="text-4xl font-bold text-gray-800 mb-2">å¤ªæ£’äº†ï¼</h2>
            <p id="finalScore" class="text-xl text-gray-600 mb-8 font-medium">æŒ‘æˆ°æˆåŠŸï¼Œä½ æ˜¯è‹±æ–‡å°é«˜æ‰‹ï¼</p>
            <button onclick="location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-2xl w-full py-5 text-2xl font-bold shadow-lg transition-transform active:scale-95">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        /* é¡Œåº«æ•¸æ“š */
        const quizData = [
            { word: "apple", icon: "ğŸ", question: "ç´…é€šé€šçš„æ°´æœæ˜¯ä»€éº¼ï¼Ÿ", char: "ğŸ»" },
            { word: "cat", icon: "ğŸ±", question: "èª°åœ¨å–µå–µå«å‘¢ï¼Ÿ", char: "ğŸ±" },
            { word: "dog", icon: "ğŸ¶", question: "å°ç‹—è¦æ€éº¼èªªï¼Ÿ", char: "ğŸ¶" },
            { word: "ball", icon: "âš½", question: "æˆ‘å€‘ä¸€èµ·ä¾†è¸¢çƒï¼", char: "ğŸ»" },
            { word: ["fine", "good", "happy"], icon: "ğŸ˜Š", question: "How are you today?", char: "ğŸ±", isDialogue: true }
        ];

        let currentIndex = 0;
        let stars = 0;
        let isListening = false;

        /* èªéŸ³è¾¨è­˜ API åˆå§‹åŒ– */
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('micBtn').classList.add('mic-active');
                document.getElementById('micLabel').innerText = 'ğŸ‘‚ æ­£åœ¨è½...';
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('micBtn').classList.remove('mic-active');
                document.getElementById('micLabel').innerText = 'ğŸ¤ é–‹å§‹å¤§è²èªª';
            };

            recognition.onresult = (event) => {
                const said = event.results[0][0].transcript.toLowerCase();
                checkAnswer(said);
            };

            recognition.onerror = () => {
                updateMessage("ç†Šç†Šæ²’è½æ¸…æ¥šï¼Œå¯ä»¥å†èªªä¸€æ¬¡å—ï¼Ÿ", "red");
            };
        }

        /* è¼‰å…¥é¡Œç›® */
        function loadQuiz() {
            const data = quizData[currentIndex];
            document.getElementById('avatar').innerText = data.char;
            document.getElementById('displayIcon').innerText = data.icon;
            document.getElementById('questionText').innerText = data.question;
            document.getElementById('stepInfo').innerText = `Step ${currentIndex + 1} / ${quizData.length}`;
            
            const hint = data.isDialogue ? "èªªï¼šI am fine" : `èªªèªªçœ‹ï¼š${data.word}`;
            document.getElementById('hintText').innerText = hint;
            
            updateMessage("é»æ“Šéº¥å…‹é¢¨ï¼Œå°æˆ‘èªªè‹±æ–‡å§ï¼", "blue");
            speak(data.question, 'zh-TW');
        }

        /* è™•ç†éº¥å…‹é¢¨é»æ“Š */
        function handleMic() {
            if (!recognition) {
                alert("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³åŠŸèƒ½ï¼Œè«‹ä½¿ç”¨ Chrome é–‹å•Ÿã€‚");
                return;
            }
            if (isListening) return;
            recognition.start();
        }

        /* æª¢æŸ¥ç­”æ¡ˆ */
        function checkAnswer(said) {
            const data = quizData[currentIndex];
            const targets = Array.isArray(data.word) ? data.word : [data.word];
            const isCorrect = targets.some(t => said.includes(t));

            if (isCorrect) {
                stars++;
                document.getElementById('starCount').innerText = `â­ ${stars}`;
                updateMessage(`ğŸ‰ å¤ªæ£’äº†ï¼ä½ èªªäº†ã€Œ${said}ã€`, "green");
                triggerWinEffects();
                
                setTimeout(() => {
                    if (currentIndex < quizData.length - 1) {
                        currentIndex++;
                        loadQuiz();
                    } else {
                        showFinalWin();
                    }
                }, 2000);
            } else {
                updateMessage(`ğŸ˜¯ è½èµ·ä¾†åƒã€Œ${said}ã€ï¼Œå†è©¦ä¸€æ¬¡ï¼Ÿ`, "red");
                speak("Try again", "en-US");
                document.getElementById('avatar').classList.add('bounce');
                setTimeout(() => document.getElementById('avatar').classList.remove('bounce'), 500);
            }
        }

        /* è·³éé¡Œç›® */
        function skipQuestion() {
            if (currentIndex < quizData.length - 1) {
                currentIndex++;
                loadQuiz();
            } else {
                showFinalWin();
            }
        }

        /* é¡¯ç¤ºæˆåŠŸè¨Šæ¯ */
        function updateMessage(text, color) {
            const board = document.getElementById('messageBoard');
            board.innerText = text;
            board.className = `h-20 flex items-center justify-center text-lg font-bold mb-8 rounded-2xl px-4 border transition-colors duration-300`;
            
            if (color === "green") board.classList.add('bg-green-50', 'text-green-600', 'border-green-100');
            else if (color === "red") board.classList.add('bg-red-50', 'text-red-500', 'border-red-100');
            else board.classList.add('bg-blue-50', 'text-blue-600', 'border-blue-100');
        }

        /* å™´ç´™èŠ±æ•ˆæœ */
        function triggerWinEffects() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#3b82f6', '#fbbf24', '#f43f5e']
            });
            speak("Great job!", "en-US");
        }

        /* çµæŸè¦–çª— */
        function showFinalWin() {
            document.getElementById('finalScore').innerText = `ä½ ä¸€å…±æ”¶é›†äº† ${stars} é¡†æ˜Ÿæ˜Ÿï¼`;
            document.getElementById('winModal').classList.replace('hidden', 'flex');
            speak("Excellent! You finished all challenges!", "en-US");
        }

        /* èªéŸ³æ’­æ”¾ */
        function speak(text, lang) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = lang;
            window.speechSynthesis.speak(utter);
        }

        /* åˆå§‹åŒ–è¼‰å…¥ */
        window.onload = loadQuiz;
    </script>
</body>
</html>
